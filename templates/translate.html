<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <title>AI Fusion â€“ Dá»‹ch & Giá»ng NÃ³i</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@400;600&display=swap" rel="stylesheet" />
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap" rel="stylesheet">
  <style>
    body {
      background: linear-gradient(120deg, #e0e7ff 0%, #f3f4f6 100%);
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
      min-height: 100vh;
      padding: 2rem 1rem;
      color: #2c2c2c;
    }
    .box {
      max-width: 760px;
      margin: 0 auto 3rem;
      background: #fff;
      border-radius: 24px;
      box-shadow: 0 15px 40px rgba(50, 50, 93, 0.1);
      padding: 40px 35px;
      display: flex;
      flex-direction: column;
      gap: 1.8rem;
      

    }
    h2 {
      font-weight: 700;
      font-size: 2.2rem;
      color: #3a3a3a;
      text-align: center;
      margin-bottom: 2.5rem;
      user-select: none;
      letter-spacing: 1.2px;
    
    }
    h4 {
      font-weight: 600;
      font-size: 1.2rem;
      color: #444;
      margin-bottom: 1rem;
      border-bottom: 2px solid #6c63ff;
      padding-bottom: 6px;
      user-select: none;
      
    }

    /* Textarea */
    textarea.form-control {
      min-height: 140px;
      resize: vertical;
      font-size: 1rem;
      padding: 12px 15px;
      border-radius: 12px;
      border: 1.8px solid #ccc;
      transition: border-color 0.3s ease;
    

    }
    textarea.form-control:focus {
      border-color: #6c63ff;
      box-shadow: 0 0 6px rgba(108, 99, 255, 0.3);
      outline: none;
  

    }

    /* Select box */
    select.form-select {
      border-radius: 12px;
      border: 1.8px solid #ccc;
      font-size: 1rem;
      padding: 8px 12px;
      transition: border-color 0.3s ease;
    
    }
    select.form-select:focus {
      border-color: #6c63ff;
      box-shadow: 0 0 6px rgba(108, 99, 255, 0.3);
      outline: none;

    }

    /* Buttons */
    .btn-primary {
      background-color: #6c63ff;
      border: none;
      font-weight: 600;
      font-size: 1.05rem;
      border-radius: 14px;
      padding: 10px 0;
      transition: background-color 0.3s ease;
      box-shadow: 0 6px 12px rgba(108, 99, 255, 0.3);
    
    }
    .btn-primary:hover {
      background-color: #574fd6;
      box-shadow: 0 8px 16px rgba(87, 79, 214, 0.5);
    

    }
    .btn-danger {
      background-color: #ff4d4f;
      border: none;
      font-weight: 600;
      font-size: 1rem;
      border-radius: 14px;
      padding: 9px 20px;
      transition: background-color 0.3s ease;
      box-shadow: 0 6px 12px rgba(255, 77, 79, 0.4);
      

    }
    .btn-danger:hover {
      background-color: #d9363e;
      box-shadow: 0 8px 16px rgba(217, 54, 62, 0.6);
    }
    .btn-warning {
      background-color: #ffc107;
      color: black;
      font-weight: 600;
      font-size: 1rem;
      border-radius: 14px;
      padding: 9px 20px;
      border: none;
      transition: background-color 0.3s ease, color 0.3s ease;
      box-shadow: 0 6px 12px rgba(255, 193, 7, 0.4);

    }
    .btn-warning:hover {
      background-color: #e0a800;
      color: black;
      box-shadow: 0 8px 16px rgba(224, 168, 0, 0.6);
    }
    .btn-success {
      background-color: #28a745;
      border: none;
      font-weight: 600;
      font-size: 1rem;
      border-radius: 14px;
      padding: 9px 24px;
      transition: background-color 0.3s ease;
      box-shadow: 0 6px 12px rgba(40, 167, 69, 0.4);
    }
    .btn-success:hover {
      background-color: #218838;
      box-shadow: 0 8px 16px rgba(33, 136, 56, 0.6);
    }

    /* Alert */
    .alert {
      font-size: 1rem;
      line-height: 1.5;
      border-radius: 12px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
      user-select: text;
    }

    /* Audio */
    audio {
      width: 100%;
      margin-top: 14px;
      border-radius: 12px;
      box-shadow: 0 3px 12px rgba(0,0,0,0.15);
    }

    /* Form rows */
    .form-row {
      display: flex;
      flex-wrap: wrap;
      gap: 1rem;
      align-items: flex-end;
      margin-top: 1.6rem;
    }
    .form-row > * {
      flex-grow: 1;
    }
    .form-row .col-md-8 {
      flex: 1 1 60%;
      min-width: 200px;
    }
    .form-row .col-md-4 {
      flex: 1 1 35%;
      min-width: 120px;
    }

    /* Mic button and status */
    #speechForm .mb-3 {
      display: flex;
      align-items: center;
      gap: 1rem;
      flex-wrap: wrap;
    }
    #speechForm .btn-danger {
      min-width: 140px;
    }
    #recordingStatus {
      font-style: italic;
      color: #555;
      user-select: none;
      flex-grow: 1;
      font-size: 0.9rem;
    }

    /* Text center btn quay láº¡i */
    .text-center.mt-4 {
      margin-top: 3rem !important;
      user-select: none;
    }

    /* Responsive tweaks */
    @media (max-width: 576px) {
      .form-row {
        flex-direction: column;
      }
      .form-row > * {
        flex-grow: 1 !important;
        min-width: auto !important;
      }
      #speechForm .mb-3 {
        flex-direction: column;
        align-items: stretch;
      }
      #speechForm .btn-danger {
        width: 100%;
        min-width: unset;
      }
    }
  </style>
</head>

<body>
  <div class="box">
    <h2>ğŸŒ AI Fusion â€“ Dá»‹ch & Giá»ng NÃ³i</h2>

    <!-- PHáº¦N 1: Dá»‹ch VÄƒn Báº£n -->
    <h4>âœï¸ Dá»‹ch VÄƒn Báº£n</h4>
    <form method="POST" action="/translate" class="mb-4">
      <textarea name="text_input" class="form-control" placeholder="Nháº­p ná»™i dung Ä‘á»ƒ dá»‹ch...">{{ original_text }}</textarea>
      <div class="form-row mt-3 align-items-end">
        <div class="col-md-8">
          <label class="form-label fw-semibold mb-1">NgÃ´n ngá»¯ Ä‘Ã­ch:</label>
          <select name="lang" class="form-select">
            <option value="en" {% if lang == 'en' %}selected{% endif %}>ğŸ‡¬ğŸ‡§ Tiáº¿ng Anh</option>
            <option value="vi" {% if lang == 'vi' %}selected{% endif %}>ğŸ‡»ğŸ‡³ Tiáº¿ng Viá»‡t</option>
            <option value="ja" {% if lang == 'ja' %}selected{% endif %}>ğŸ‡¯ğŸ‡µ Tiáº¿ng Nháº­t</option>
            <option value="ko" {% if lang == 'ko' %}selected{% endif %}>ğŸ‡°ğŸ‡· Tiáº¿ng HÃ n</option>
            <option value="fr" {% if lang == 'fr' %}selected{% endif %}>ğŸ‡«ğŸ‡· Tiáº¿ng PhÃ¡p</option>
            <option value="zh" {% if lang == 'zh' %}selected{% endif %}>ğŸ‡¨ğŸ‡³ Tiáº¿ng Trung</option>
            <option value="th" {% if lang == 'th' %}selected{% endif %}>ğŸ‡¹ğŸ‡­ Tiáº¿ng ThÃ¡i</option>
            <option value="es" {% if lang == 'es' %}selected{% endif %}>ğŸ‡ªğŸ‡¸ Tiáº¿ng TÃ¢y Ban Nha</option>
            <option value="de" {% if lang == 'de' %}selected{% endif %}>ğŸ‡©ğŸ‡ª Tiáº¿ng Äá»©c</option>
            <option value="ru" {% if lang == 'ru' %}selected{% endif %}>ğŸ‡·ğŸ‡º Tiáº¿ng Nga</option>
          </select>
        </div>
        <div class="col-md-4 d-grid mt-2 mt-md-0">
          <button type="submit" class="btn btn-primary">ğŸ” Dá»‹ch</button>
        </div>
      </div>
    </form>

{% if translated %}
<div class="mt-3">
  <p><b>Káº¿t quáº£ dá»‹ch:</b> {{ translated }}</p>
</div>
{% endif %}

    <hr class="my-4">

    <!-- PHáº¦N 2: Ghi Ã¢m vÃ  dá»‹ch -->
    <h4>ğŸ™ï¸ Ghi Ã‚m Giá»ng NÃ³i â†’ Dá»‹ch & PhÃ¡t Ã‚m</h4>
    <form id="speechForm" method="POST" enctype="multipart/form-data" action="/speech_translate">
      <div class="mb-3">
        <label class="form-label fw-semibold">Nháº¥n mic Ä‘á»ƒ ghi Ã¢m:</label><br>
        <input type="file" name="voice_input" id="voice_input" accept="audio/*" class="form-control" hidden />
        <button type="button" class="btn btn-danger" onclick="startRecording()">ğŸ¤ Báº¯t Ä‘áº§u ghi</button>
        <span id="recordingStatus"></span>
      </div>
      <div class="mb-3">
        <label class="form-label fw-semibold">NgÃ´n ngá»¯ dá»‹ch sang:</label>
        <select name="target_lang" class="form-select">
          <option value="en">ğŸ‡¬ğŸ‡§ Tiáº¿ng Anh</option>
          <option value="vi">ğŸ‡»ğŸ‡³ Tiáº¿ng Viá»‡t</option>
          <option value="ja">ğŸ‡¯ğŸ‡µ Tiáº¿ng Nháº­t</option>
          <option value="ko">ğŸ‡°ğŸ‡· Tiáº¿ng HÃ n</option>
          <option value="fr">ğŸ‡«ğŸ‡· Tiáº¿ng PhÃ¡p</option>
          <option value="zh">ğŸ‡¨ğŸ‡³ Tiáº¿ng Trung</option>
          <option value="th">ğŸ‡¹ğŸ‡­ Tiáº¿ng ThÃ¡i</option>
          <option value="es">ğŸ‡ªğŸ‡¸ Tiáº¿ng TÃ¢y Ban Nha</option>
          <option value="de">ğŸ‡©ğŸ‡ª Tiáº¿ng Äá»©c</option>
          <option value="ru">ğŸ‡·ğŸ‡º Tiáº¿ng Nga</option>
        </select>
      </div>
      <button id="submitBtn" type="submit" class="btn btn-warning" disabled>ğŸš€ Gá»­i & Dá»‹ch</button>
    </form>

    {% if speech_translated %}
    <div class="alert alert-secondary mt-4">
      ğŸ—£ï¸ <strong>Giá»ng nÃ³i thÃ nh chá»¯:</strong> {{ speech_text }}<br />
      ğŸŒ <strong>Dá»‹ch:</strong> {{ speech_translated }}
    </div>
    {% endif %}

    {% if audio_file %}
    <audio controls autoplay>
        <source src="{{ audio_file }}" type="audio/mpeg">
    </audio>
    {% endif %}

    <div class="text-center mt-4">
      <a href="/" class="btn btn-outline-secondary mt-3">&larr; Quay láº¡i trang chá»§</a>
    </div>
  </div>

  <script>
    let mediaRecorder;
    let audioChunks = [];

    async function startRecording() {
      const status = document.getElementById("recordingStatus");
      status.textContent = "ğŸ™ï¸ Äang ghi Ã¢m...";
      const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
      mediaRecorder = new MediaRecorder(stream);

      audioChunks = [];
      mediaRecorder.ondataavailable = e => audioChunks.push(e.data);

      mediaRecorder.onstop = async () => {
        const blob = new Blob(audioChunks, { type: 'audio/webm' });
        const file = new File([blob], "recorded.webm", { type: 'audio/webm' });
        const input = document.getElementById("voice_input");
        const dataTransfer = new DataTransfer();
        dataTransfer.items.add(file);
        input.files = dataTransfer.files;
        document.getElementById("submitBtn").disabled = false;
        status.textContent = "âœ… Ghi xong! Nháº¥n gá»­i Ä‘á»ƒ dá»‹ch.";
      };

      mediaRecorder.start();
      setTimeout(() => mediaRecorder.stop(), 4000);
    }
  </script>
</body>
</html>
