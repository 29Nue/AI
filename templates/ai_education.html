<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>{{ subject_name }} - AI Há»c CÃ¹ng Báº¡n</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">
  <style>
    body {
      background: linear-gradient(to right, #e0f7fa, #f1f8e9);
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;

    }
    .container-box {
      max-width: 900px;
      margin: 5vh auto;
      padding: 30px;
      background: white;
      border-radius: 24px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.1);
    }
    h1 { font-weight: 700; margin-bottom: 20px; color: #333; }
    .nav-tabs .nav-link.active { background-color: #4caf50; color: white; font-weight: 600; }
    .card { margin-bottom: 20px; }
    .card-header { font-weight: 600; font-size: 1.1rem; }
    .btn-back { margin-top: 20px; color: #555; text-decoration: none; }
    .btn-back:hover { text-decoration: underline; }
  </style>
</head>
<body>
<div class="container-box">
  <h1 style="text-align: center;">ğŸ“ {{ subject_name }}  AI Há»c CÃ¹ng Báº¡n</h1>

  <!-- Tabs -->
  <ul class="nav nav-tabs mb-3" id="educationTabs" role="tablist">
    <li class="nav-item" role="presentation">
      <button class="nav-link active" id="class-tab" data-bs-toggle="tab" data-bs-target="#class" type="button">ğŸ« Lá»›p Há»c</button>
    </li>
    <li class="nav-item" role="presentation">
      <button class="nav-link" id="lecture-tab" data-bs-toggle="tab" data-bs-target="#lecture" type="button">ğŸ“– BÃ i Giáº£ng</button>
    </li>
    <li class="nav-item" role="presentation">
      <button class="nav-link" id="quiz-tab" data-bs-toggle="tab" data-bs-target="#quiz" type="button">ğŸ“ Kiá»ƒm Tra</button>
    </li>
    <li class="nav-item" role="presentation">
      <button class="nav-link" id="links-tab" data-bs-toggle="tab" data-bs-target="#links" type="button">ğŸ”— Link Há»c Táº­p</button>
    </li>
  </ul>

  <!-- Tab Content -->
  <div class="tab-content" id="educationTabsContent">

    <!-- Lá»›p Há»c -->
    <div class="tab-pane fade show active" id="class">
      <!-- NÃºt ThÃªm Lá»›p -->
      <div class="mb-3 text-end">
        {% if session.get('role') in ['admin', 'teacher'] %}
        <button class="btn btn-success btn-sm" data-bs-toggle="collapse" data-bs-target="#addClassForm">
          <i class="bi bi-plus-circle"></i> ThÃªm Lá»›p Há»c
        </button>
      {% endif %}

      </div>
      <div class="collapse mb-3" id="addClassForm">
        <form method="POST">
          <input type="text" name="class_name" placeholder="TÃªn lá»›p há»c" class="form-control mb-2" required>
          <input type="text" name="teacher" placeholder="GiÃ¡o viÃªn" class="form-control mb-2" required>
          <input type="text" name="time" placeholder="Thá»i gian" class="form-control mb-2" required>
          <textarea name="description" placeholder="MÃ´ táº£" class="form-control mb-2" required></textarea>
          <button type="submit" class="btn btn-primary btn-sm">Táº¡o Lá»›p</button>
        </form>
      </div>
      
      <!-- Danh sÃ¡ch lá»›p há»c -->
    {% for cls in classrooms %}
    <div class="card d-flex flex-row align-items-center justify-content-between mb-2">
      <div class="card-body">
        <strong>{{ cls.name }}</strong><br>
        GiÃ¡o viÃªn: {{ cls.teacher }}<br>
        Thá»i gian: {{ cls.time }}<br>
        MÃ´ táº£: {{ cls.description }}<br><br>

        {% if cls.status == "done" %}
          <span class="badge bg-success">ÄÃ£ hoÃ n thÃ nh âœ…</span>
        {% else %}
          <a href="/class/{{ cls.id }}" class="btn btn-primary btn-sm">
            <i class="bi bi-door-open"></i> VÃ o PhÃ²ng Há»c
          </a>

          {% if session.get('role') == "student" %}
            <!-- NÃºt Ä‘Äƒng kÃ½ há»c -->
            <form method="POST" action="/class/{{ cls.id }}/register" class="d-inline">
              <button type="submit" class="btn btn-warning btn-sm">
                <i class="bi bi-pencil-square"></i> ÄÄƒng kÃ½ há»c
              </button>
            </form>
          {% endif %}
        {% endif %}
      </div>

        {% if session.get('role') in ['admin','teacher'] %}
        <div class="px-3 pb-2 text-muted small d-flex align-items-center gap-2">
          <h6 class="mb-0 fw-semibold" style="font-size: 0.9rem;">
            ğŸ“‹ Danh sÃ¡ch Ä‘Äƒng kÃ½ há»c
          </h6>
          <a href="{{ url_for('view_registers') }}" 
            class="btn btn-outline-info btn-sm ms-2">
            Xem chi tiáº¿t
          </a>
        </div>
      {% endif %}


      <!-- Cá»™t bÃªn pháº£i chá»©a nÃºt -->
      <div class="p-3 d-flex flex-column gap-2">
        {% if cls.status != "done" %}
          <!-- NÃºt hoÃ n thÃ nh -->
          {% if session.get('role') in ["admin", "teacher"] %}
          <form method="POST" action="/class/{{ cls.id }}/complete">
            <button type="submit" class="btn btn-outline-success btn-sm" title="ÄÃ¡nh dáº¥u hoÃ n thÃ nh">
              <i class="bi bi-check-lg"></i>
            </button>
          </form>
          {% endif %}
        {% else %}
          <!-- NÃºt xÃ³a khi Ä‘Ã£ hoÃ n thÃ nh -->
          {% if session.get('role') in ["admin", "teacher"] %}
          <form method="POST" action="/class/{{ cls.id }}/delete" 
                onsubmit="return confirm('Báº¡n cÃ³ cháº¯c muá»‘n xÃ³a lá»›p nÃ y khÃ´ng?');">
            <button type="submit" class="btn btn-outline-danger btn-sm" title="XÃ³a lá»›p">
              <i class="bi bi-trash"></i>
            </button>
          </form>
          {% endif %}
        {% endif %}
      </div>
    </div>
    {% endfor %}
</div>
 <!-- BÃ i Giáº£ng -->
<div class="tab-pane fade" id="lecture">

  <!-- NÃºt thÃªm bÃ i giáº£ng -->
  <div class="text-end mb-2">
    {% if session.get("role") in ["admin", "teacher"] %}
      <button class="btn btn-success btn-sm" data-bs-toggle="collapse" data-bs-target="#addLectureForm">
        <i class="bi bi-plus-circle"></i> ThÃªm BÃ i Giáº£ng
      </button>
    {% endif %}
  </div>


  <!-- Form thÃªm bÃ i giáº£ng -->
    <div class="collapse mb-2" id="addLectureForm">
      <form method="POST" action="{{ url_for('upload_lecture') }}" enctype="multipart/form-data">
        <input type="text" name="title" placeholder="TiÃªu Ä‘á» bÃ i giáº£ng" class="form-control mb-2" required>

        <!-- Cho phÃ©p PDF, Word, PowerPoint, ZIP, hÃ¬nh (jpg, png, gif) vÃ  video (mp4, webm, mov) -->
        <input type="file" name="file" class="form-control mb-2" 
              accept=".pdf,.doc,.docx,.ppt,.pptx,.zip,.jpg,.jpeg,.png,.gif,.mp4,.webm,.mov" required>

        <button type="submit" class="btn btn-primary btn-sm">ğŸ“¤ Upload</button>
      </form>
    </div>


<!-- Danh sÃ¡ch bÃ i giáº£ng dáº¡ng báº£ng -->
{% if lectures %}
<table class="table table-striped table-bordered">
  <thead>
    <tr>
      <th>TiÃªu Ä‘á»</th>
      <th>NgÆ°á»i táº£i lÃªn</th>
      <th>NgÃ y táº£i</th>
      <th>Xem</th>
      <th>Táº£i vá»</th>
      {% if session.get('role') in ['admin', 'teacher'] %}
      <th>HÃ nh Ä‘á»™ng</th>
      {% endif %}
    </tr>
  </thead>
  <tbody>
    {% for lec in lectures %}
    <tr>
      <td>{{ lec.title }}</td>
      <td>{{ lec.uploader }}</td>
      <td>{{ lec.uploaded_at if lec.uploaded_at else 'N/A' }}</td>
      <td>
        {% set ext = lec.filename.split('.')[-1].lower() %}
        {% if ext == 'pdf' %}
          <a href="{{ url_for('view_lecture', filename=lec.filename) }}" target="_blank" class="btn btn-primary btn-sm">ğŸ‘ Xem PDF</a>
        {% else %}
          <span class="text-muted" title="Chá»‰ PDF má»›i xem trá»±c tiáº¿p Ä‘Æ°á»£c">âŒ</span>
        {% endif %}
      </td>
      <td>
        <a href="{{ url_for('download_lecture', filename=lec.filename) }}" class="btn btn-success btn-sm">
          ğŸ“¥ Táº£i vá»
        </a>
      </td>
      {% if session.get('role') in ['admin', 'teacher'] %}
      <td class="d-flex gap-1">
        <!-- NÃºt sá»­a -->
        <a href="{{ url_for('edit_lecture', lecture_id=lec.id) }}" class="btn btn-warning btn-sm">âœï¸</a>
        <!-- NÃºt xÃ³a -->
        <form method="POST" action="{{ url_for('delete_lecture', lecture_id=lec.id) }}" 
              onsubmit="return confirm('Báº¡n cÃ³ cháº¯c muá»‘n xÃ³a bÃ i giáº£ng nÃ y khÃ´ng?');">
          <button type="submit" class="btn btn-danger btn-sm">ğŸ—‘ï¸</button>
        </form>
      </td>
      {% endif %}
    </tr>
    {% endfor %}
  </tbody>
</table>
{% else %}
<p class="text-muted m-0">ChÆ°a cÃ³ bÃ i giáº£ng nÃ o Ä‘Æ°á»£c táº£i lÃªn.</p>
{% endif %}
</div>

<!-- Kiá»ƒm Tra -->
<div class="tab-pane fade" id="quiz">
  <div class="card shadow-sm">
    <div class="card-header d-flex justify-content-between align-items-center bg-light">
      <span class="fw-bold">ğŸ“˜ Quáº£n lÃ½ bÃ i kiá»ƒm tra</span>
      {% if session.get('role') in ["teacher","admin"] %}
      <div>
        <button class="btn btn-success btn-sm me-1" data-bs-toggle="modal" data-bs-target="#autoQuizModal">
          ğŸ¤– Táº¡o tráº¯c nghiá»‡m tá»± Ä‘á»™ng (AI)
        </button>
      </div>
      {% endif %}
    </div>
    <div class="card-body">
      {% if quizzes %}
        <div class="d-flex flex-column gap-3">
          {% for quiz in quizzes %}
          <div class="border rounded p-3 bg-white shadow-sm">
            <div class="d-flex justify-content-between align-items-start flex-wrap">
              <!-- ThÃ´ng tin bÃ i kiá»ƒm tra -->
              <div class="me-3">
                <h6 class="fw-bold mb-1">{{ quiz.title }}</h6>
                <small class="text-muted">
                  NgÆ°á»i táº¡o: {{ quiz.creator }} | 
                  Loáº¡i: {{ quiz.type }} | 
                  NgÃ y táº¡o: {{ quiz.created_at }}
                </small><br>
                <small class="text-muted">
                  Thá»i gian: {{ quiz.duration }} phÃºt | 
                  Sá»‘ cÃ¢u: {{ quiz.num_questions }}
                </small>
               <div class="mt-2">
                {% if not session.get('username') %}
                  <!-- ChÆ°a Ä‘Äƒng nháº­p -->
                  <button class="btn btn-outline-secondary btn-sm" disabled title="Vui lÃ²ng Ä‘Äƒng nháº­p Ä‘á»ƒ lÃ m bÃ i">
                    ğŸ”‘ ÄÄƒng nháº­p Ä‘á»ƒ lÃ m
                  </button>

                {% elif quiz.has_done %}
                  <!-- ÄÃ£ lÃ m -->
                  <span class="badge bg-success">âœ… ÄÃ£ lÃ m</span>

                {% else %}
                  <!-- ÄÃ£ Ä‘Äƒng nháº­p & chÆ°a lÃ m -->
                  <a href="{% if not quiz.locked %}{{ url_for('start_quiz', quiz_id=quiz.id) }}{% else %}#{% endif %}"
                    class="btn btn-primary btn-sm {% if quiz.locked %}disabled{% endif %}" 
                    {% if quiz.locked %}title="BÃ i kiá»ƒm tra Ä‘Ã£ bá»‹ khÃ³a"{% endif %}>
                    ğŸ“ Báº¯t Ä‘áº§u
                  </a>
                {% endif %}
              </div>

              </div>

              <!-- CÃ¡c nÃºt quáº£n lÃ½ -->
              <div class="d-flex flex-column gap-2 align-items-end">
                <a href="{{ url_for('quiz_results_list', quiz_id=quiz.id) }}" 
                   class="btn btn-info btn-sm w-100">
                  ğŸ“‹ Xem káº¿t quáº£
                </a>
                {% if quiz.locked %}
                <button class="btn btn-secondary btn-sm w-100" disabled>ğŸ”’ ÄÃ£ khÃ³a</button>
                {% else %}
                  {% if session.get("username") == quiz.creator or session.get("role") == "admin" %}
                    <form method="POST" action="{{ url_for('lock_quiz', quiz_id=quiz.id) }}">
                      <button type="submit" class="btn btn-warning btn-sm w-100">
                        ğŸ”’ KhÃ³a bÃ i kiá»ƒm tra
                      </button>
                    </form>
                  {% endif %}
                {% endif %}
                <!-- NÃºt xÃ³a -->
                {% if session.get('role') == "admin" or (session.get('role') == "teacher" and session.get('username') == quiz.creator) %}
                <form method="POST" action="{{ url_for('delete_quiz', quiz_id=quiz.id) }}" 
                      onsubmit="return confirm('Báº¡n cÃ³ cháº¯c cháº¯n muá»‘n xÃ³a bÃ i kiá»ƒm tra nÃ y khÃ´ng?');">
                  <button type="submit" class="btn btn-danger btn-sm w-100">
                    ğŸ—‘ï¸ XÃ³a
                  </button>
                </form>
                {% endif %}
              </div>
            </div>
          </div>
          {% endfor %}
        </div>
      {% else %}
        <p class="text-muted">ChÆ°a cÃ³ bÃ i kiá»ƒm tra nÃ o</p>
      {% endif %}
    </div>
  </div>
</div>

<!-- Modal: Táº¡o tráº¯c nghiá»‡m tá»± Ä‘á»™ng (AI) -->
<div class="modal fade" id="autoQuizModal" tabindex="-1">
  <div class="modal-dialog">
    <form method="POST" action="{{ url_for('create_auto_quiz') }}" enctype="multipart/form-data" class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">ğŸ¤– Táº¡o bÃ i kiá»ƒm tra tráº¯c nghiá»‡m tá»± Ä‘á»™ng</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <div class="mb-2">
          <label>TiÃªu Ä‘á»</label>
          <input type="text" name="title" class="form-control" required>
        </div>
        <div class="mb-2">
          <label>Thá»i gian (phÃºt)</label>
          <input type="number" name="duration" class="form-control" required>
        </div>
        <div class="mb-2">
          <label>Táº£i file Word (chá»©a cÃ¢u há»i & Ä‘Ã¡p Ã¡n)</label>
          <input type="file" name="file" accept=".doc,.docx" class="form-control" required>
        </div>
      </div>
      <div class="modal-footer">
        <button type="submit" class="btn btn-success">Táº¡o</button>
      </div>
    </form>
  </div>
</div>

    <!-- Tab Link Há»c Táº­p -->
<div class="tab-pane fade" id="links">
  <!-- NÃºt thÃªm link -->
  <div class="mb-3 text-end">
    {% if session.get("username") %}
    <button class="btn btn-success btn-sm" data-bs-toggle="collapse" data-bs-target="#addLinkForm">
      <i class="bi bi-plus-circle"></i> ThÃªm Link Há»c Táº­p
    </button>
    {% endif %}
  </div>

  <!-- Form thÃªm link -->
  <div class="collapse mb-3" id="addLinkForm">
    <form method="POST" action="{{ url_for('add_link') }}">
      <input type="text" name="title" placeholder="TÃªn link" class="form-control mb-2" required>
      <input type="text" name="description" placeholder="MÃ´ táº£ link" class="form-control mb-2">
      <input type="url" name="url" placeholder="ÄÆ°á»ng dáº«n (https://...)" class="form-control mb-2" required>
      <button type="submit" class="btn btn-primary btn-sm">ğŸ“¤ ThÃªm Link</button>
    </form>
  </div>

  <!-- Danh sÃ¡ch link -->
  <style>
  /* Thu nhá» font chá»¯ vÃ  padding báº£ng */
  table.table-sm th, table.table-sm td {
    padding: 0.25rem 0.5rem;
    font-size: 0.900rem;
    vertical-align: middle;
  }

  /* Giá»›i háº¡n width cá»™t HÃ nh Ä‘á»™ng */
  table.table-sm th.action-col, table.table-sm td.action-col {
    width: 80px;
    text-align: center;
    white-space: nowrap; /* khÃ´ng xuá»‘ng dÃ²ng */
  }

  /* NÃºt xÃ³a nhá» hÆ¡n */
  .btn-sm {
    font-size: 0.75rem;
    padding: 0.25rem 0.4rem;
  }
</style>

  {% if links %}
  <table class="table table-striped table-bordered table-sm">
    <thead>
      <tr>
        <th>TÃªn</th>
        <th>MÃ´ táº£</th>
        <th>URL</th>
        {% if session.get("role") in ["admin", "teacher"] %}
        <th class="action-col">HÃ nh Ä‘á»™ng</th>
        {% endif %}
      </tr>
    </thead>
    <tbody>
      {% for link in links %}
      <tr>
        <td>{{ link.title }}</td>
        <td>{{ link.description }}</td>
        <td><a href="{{ link.url }}" target="_blank">{{ link.url }}</a></td>
        {% if session.get("role") in ["admin", "teacher"] %}
        <td class="action-col">
          <form method="POST" action="{{ url_for('delete_link', link_id=link.id) }}" 
                onsubmit="return confirm('Báº¡n cÃ³ cháº¯c muá»‘n xÃ³a link nÃ y khÃ´ng?');">
            <button type="submit" class="btn btn-outline-danger btn-sm">âŒ</button>
          </form>
        </td>
        {% endif %}
      </tr>
      {% endfor %}
    </tbody>
  </table>
  {% else %}
  <p class="text-muted m-0">ChÆ°a cÃ³ link há»c táº­p nÃ o.</p>
  {% endif %}


  </div> <!-- Ä‘Ã³ng tab-content -->

  <a href="/" class="btn btn-outline-secondary mt-3">&larr; Quay láº¡i trang chá»§</a>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
