<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>ü§ñ AI T·∫°o L·ªãch Tr√¨nh</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@500;700&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">
   <style>
        body {
            background: linear-gradient(to right, #e0f7fa, #fce4ec);
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            color: #333;
        }
        .container-box {
            max-width: 950px;
            margin: 5vh auto;
            padding: 40px;
            background: white;
            border-radius: 24px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        .upload-area {
            border: 2px dashed #ccc;
            border-radius: 12px;
            padding: 50px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .upload-area:hover {
            border-color: #0d6efd;
            background-color: #f0f8ff;
        }
        .upload-icon {
            font-size: 3rem;
            color: #0d6efd;
        }
        .result-area {
            margin-top: 30px;
            padding: 20px;
            border: 1px solid #eee;
            border-radius: 12px;
            background-color: #f9f9f9;
        }
        .spinner { display: none; }

        @keyframes sortShake {
        0% { transform: translateY(0); }
        25% { transform: translateY(-4px); }
        50% { transform: translateY(0); }
        75% { transform: translateY(3px); }
        100% { transform: translateY(0); }
        }
        .shake {
        animation: sortShake 0.4s ease;
        }
        
        #filter-date-hoc,
        #filter-subject-hoc,
        #filter-group-hoc {
        font-size: 0.9rem;
        padding: 6px 8px;
        }

        button#filter-btn-hoc,
        button#show-all-btn-hoc,
        button#sort-btn-hoc {
        width: 40px;
        height: 40px;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 8px;
        transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        button#filter-btn-hoc:hover,
        button#show-all-btn-hoc:hover,
        button#sort-btn-hoc:hover {
        transform: translateY(-2px);
        box-shadow: 0 3px 6px rgba(0,0,0,0.15);
        }


    </style>
</head>
<body>
<div class="container-box">
    <h1 class="text-center mb-4">ü§ñ AI T·∫°o L·ªãch Tr√¨nh</h1>

    <!-- Tabs -->
    <ul class="nav nav-tabs mb-3" id="scheduleTabs" role="tablist">
        <li class="nav-item" role="presentation">
            <button class="nav-link active" id="hoc-tab" data-bs-toggle="tab" data-bs-target="#hoc" type="button" role="tab">üìö L·ªãch h·ªçc</button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="thi-tab" data-bs-toggle="tab" data-bs-target="#thi" type="button" role="tab">üìù L·ªãch thi</button>
        </li>
    </ul>

    <div class="tab-content" id="scheduleTabsContent">
        <!-- L·ªãch h·ªçc -->
        <div class="tab-pane fade show active" id="hoc" role="tabpanel">
            <!-- Upload -->
            <div class="upload-area" id="upload-area-hoc">
                <i class="bi bi-cloud-upload upload-icon"></i>
                <p class="mt-2">K√©o & th·∫£ ·∫£nh <b>l·ªãch h·ªçc</b> v√†o ƒë√¢y ho·∫∑c 
                <label for="file-upload-hoc" class="text-primary" style="cursor:pointer;">t·∫£i l√™n</label>.</p>
                <input type="file" id="file-upload-hoc" accept="image/*" style="display:none" />
            </div>

            <div id="loading-spinner-hoc" class="text-center mt-4 spinner">
                <div class="spinner-border text-primary"></div>
                <p class="mt-2">AI ƒëang ph√¢n t√≠ch l·ªãch h·ªçc...</p>
            </div>

            <div id="preview-image-hoc" class="mt-3 text-center" style="display:none;">
                <h5>·∫¢nh l·ªãch h·ªçc:</h5>
                <img id="image-preview-hoc" src="#" alt="·∫¢nh l·ªãch h·ªçc" class="img-fluid rounded shadow-sm" />
            </div>

            <div id="result-area-hoc" class="result-area" style="display:none;">
                <h4 class="text-center mb-3">Th√¥ng Tin L·ªãch H·ªçc</h4>
                <div id="schedule-details-hoc"></div>
            </div>

            <!-- Danh s√°ch theo ng√†y -->
           <div class="mt-4">
            <h4 class="text-center mb-3">üìÖ Danh S√°ch L·ªãch H·ªçc</h4>

            <div class="d-flex justify-content-center align-items-center flex-wrap gap-2 mb-3">
                <input type="date" id="filter-date-hoc" class="form-control w-auto" style="min-width: 160px;">
                <select id="filter-subject-hoc" class="form-select w-auto" style="min-width: 160px;">
                <option value="">-- M√¥n h·ªçc --</option>
                </select>
                <select id="filter-group-hoc" class="form-select w-auto" style="min-width: 160px;">
                <option value="">-- Nh√≥m --</option>
                </select>

                <!-- Nh√≥m n√∫t bi·ªÉu t∆∞·ª£ng -->
                <div class="d-flex align-items-center gap-2 ms-2">
                <button id="filter-btn-hoc" class="btn btn-primary" title="L·ªçc">
                    <i class="bi bi-funnel-fill"></i>
                </button>
                <button id="show-all-btn-hoc" class="btn btn-success" title="Hi·ªán t·∫•t c·∫£">
                    <i class="bi bi-collection"></i>
                </button>
                <button id="sort-btn-hoc" class="btn btn-outline-secondary" title="S·∫Øp x·∫øp">
                    <i class="bi bi-sort-down-alt"></i>
                </button>
                </div>
            </div>

            <div id="daily-schedule-hoc" class="accordion"></div>
        </div>
        </div>
        <!-- L·ªãch thi -->
        <div class="tab-pane fade" id="thi" role="tabpanel">
            <!-- Upload -->
           <div class="upload-area" id="upload-area-thi" style="cursor: pointer; border: 2px dashed #007bff; border-radius: 10px; padding: 20px; text-align: center;">
                <i class="bi bi-cloud-upload upload-icon" style="font-size: 2rem; color: #007bff;"></i>
                <p class="mt-2">K√©o & th·∫£ ·∫£nh <b>l·ªãch thi</b> v√†o ƒë√¢y ho·∫∑c click ƒë·ªÉ ch·ªçn ·∫£nh.</p>
                <input type="file" id="file-upload-thi" accept="image/*" style="display:none" />
            </div>

            <div id="loading-spinner-thi" class="text-center mt-4 spinner">
                <div class="spinner-border text-primary"></div>
                <p class="mt-2">AI ƒëang ph√¢n t√≠ch l·ªãch thi...</p>
            </div>

            <div id="preview-image-thi" class="mt-3 text-center" style="display:none;">
                <h5>·∫¢nh l·ªãch thi:</h5>
                <img id="image-preview-thi" src="#" alt="·∫¢nh l·ªãch thi" class="img-fluid rounded shadow-sm" />
            </div>

            <!-- K·∫øt qu·∫£ AI -->
            <div id="result-area-thi" class="result-area" style="display:none;">
                <h4 class="text-center mb-3">Th√¥ng Tin L·ªãch Thi</h4>
                <div id="schedule-details-thi"></div>
            </div>

            <!-- Danh s√°ch l·ªãch thi -->
            <div class="mt-4">
                <h4 class="text-center mb-3">üìö Danh S√°ch L·ªãch Thi</h4>
                <div class="mb-3 text-center">
                    <input type="date" id="exam-filter-date" class="form-control w-25 d-inline-block" />

                    <select id="exam-filter-subject" class="form-select w-25 d-inline-block ms-2">
                        <option value="">-- Ch·ªçn m√¥n thi --</option>
                    </select>

                    <select id="exam-filter-room" class="form-select w-25 d-inline-block ms-2">
                        <option value="">-- Ch·ªçn ph√≤ng --</option>
                    </select>

                    <button id="exam-filter-btn" class="btn btn-primary ms-2">L·ªçc</button>
                    <button id="exam-show-all-btn" class="btn btn-success">ALL</button>
                </div>
                <div id="exam-schedule" class="accordion"></div>
            </div>
        </div>
    </div>
    <a href="/" class="btn btn-outline-secondary mb-4"><i class="bi bi-arrow-left"></i> Quay l·∫°i trang ch·ªß</a>
</div>


<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
const uploadArea = document.getElementById('upload-area-hoc');
const fileInput = document.getElementById('file-upload-hoc');
const previewImageContainer = document.getElementById('preview-image-hoc');
const imagePreview = document.getElementById('image-preview-hoc');
const resultArea = document.getElementById('result-area-hoc');
const scheduleDetails = document.getElementById('schedule-details-hoc');
const loadingSpinner = document.getElementById('loading-spinner-hoc');
// Upload file
uploadArea.addEventListener('click', () => fileInput.click());
['dragenter','dragover','dragleave','drop'].forEach(ev => {
    uploadArea.addEventListener(ev, e => { e.preventDefault(); e.stopPropagation(); });
});
['dragenter','dragover'].forEach(ev => uploadArea.addEventListener(ev, () => uploadArea.classList.add('is-dragover')));
['dragleave','drop'].forEach(ev => uploadArea.addEventListener(ev, () => uploadArea.classList.remove('is-dragover')));
uploadArea.addEventListener('drop', e => { const file = e.dataTransfer.files[0]; if(file) handleFile(file); });
fileInput.addEventListener('change', e => { const file = e.target.files[0]; if(file) handleFile(file); });

function handleFile(file){
    resultArea.style.display = 'none';
    loadingSpinner.style.display = 'block';

    const reader = new FileReader();
    reader.onload = e => { imagePreview.src = e.target.result; previewImageContainer.style.display='block'; };
    reader.readAsDataURL(file);

    const formData = new FormData();
    formData.append('file', file);

    fetch('/process_image', { method:'POST', body:formData })
    .then(res=>res.json())
    .then(data=>{ 
        loadingSpinner.style.display='none'; 
        showResult(data); 
        fetchAllSchedules();
    })
    .catch(err=>{
        loadingSpinner.style.display='none';
        console.error(err);
        scheduleDetails.innerHTML = `<div class="alert alert-danger">ƒê√£ c√≥ l·ªói x·∫£y ra. Vui l√≤ng th·ª≠ l·∫°i sau.</div>`;
        resultArea.style.display='block';
    });
}

function showResult(data){
    scheduleDetails.innerHTML='';
    if(!data||Object.keys(data).length===0){
        scheduleDetails.innerHTML = `<div class="alert alert-warning">Kh√¥ng th·ªÉ tr√≠ch xu·∫•t th√¥ng tin t·ª´ ·∫£nh. Vui l√≤ng th·ª≠ ·∫£nh kh√°c.</div>`;
        resultArea.style.display='block';
        return;
    }
    let html=`<div class="row mb-3"><div class="col-md-6"><p><strong>Ng√†y b·∫Øt ƒë·∫ßu h·ªçc:</strong> ${data.start_date||'N/A'}</p></div></div>
    <table class="table table-striped table-hover"><thead><tr class="table-primary">
    <th>Th·ª©</th><th>M√¥n H·ªçc</th><th>Ph√≤ng</th><th>Nh√≥m</th><th>Ti·∫øt</th><th>Th·ªùi gian</th>
    </tr></thead><tbody>`;
    const sorted = data.schedule.sort((a,b)=>{ const days={'Th·ª© Hai':2,'Th·ª© Ba':3,'Th·ª© T∆∞':4,'Th·ª© NƒÉm':5,'Th·ª© S√°u':6,'Th·ª© B·∫£y':7,'Ch·ªß Nh·∫≠t':8}; return days[a.day]-days[b.day]; });
    sorted.forEach(item=>{
        html+=`<tr><td>${item.day||'N/A'}</td><td>${item.subject||'N/A'}</td><td>${item.room||'N/A'}</td><td>${item.group||'N/A'}</td><td>${item.sessions||'N/A'}</td><td>${item.time||'N/A'}</td></tr>`;
    });
    html+='</tbody></table>';
    scheduleDetails.innerHTML=html;
    resultArea.style.display='block';
}

// Filter

function formatDateToDMY(dateStr) {
    if(!dateStr) return "";
    const [yyyy, mm, dd] = dateStr.split("-");
    return `${dd}/${mm}/${yyyy}`;
}

const filterBtn = document.getElementById('filter-btn-hoc');
const showAllBtn = document.getElementById('show-all-btn-hoc');
const filterDate = document.getElementById('filter-date-hoc');
const filterSubject = document.getElementById('filter-subject-hoc');
const filterGroup = document.getElementById('filter-group-hoc');
const dailySchedule = document.getElementById('daily-schedule-hoc');
let allSchedules=[];

function populateFilters() {
    const subjectSet = new Set();
    const groupSet = new Set();

    allSchedules.forEach(s => {
        if(s.subject) subjectSet.add(s.subject);
        if(s.group) groupSet.add(s.group);
    });

    filterSubject.innerHTML = `<option value="">-- Ch·ªçn m√¥n h·ªçc --</option>`;
    filterGroup.innerHTML = `<option value="">-- Ch·ªçn nh√≥m --</option>`;

    subjectSet.forEach(sub => {
        filterSubject.innerHTML += `<option value="${sub}">${sub}</option>`;
    });

    groupSet.forEach(gr => {
        filterGroup.innerHTML += `<option value="${gr}">${gr}</option>`;
    });
}

// Fetch all schedules
function fetchAllSchedules(){
    fetch('/get_all_schedules')
    .then(res=>res.json())
    .then(data=>{
        allSchedules = data;
        populateFilters();
        renderDailySchedule(allSchedules);
    })
    .catch(err=>console.error(err));
}
fetchAllSchedules();

// Filter click
filterBtn.addEventListener('click',()=>{
    const selectedDate = filterDate.value;
    const selectedSubject = filterSubject.value;
    const selectedGroup = filterGroup.value;

    let filtered = allSchedules;
    if(selectedDate) {
        const formattedDate = formatDateToDMY(selectedDate);
        filtered = filtered.filter(s=>s.date===formattedDate);
    }
    if(selectedSubject) filtered = filtered.filter(s=>s.subject===selectedSubject);
    if(selectedGroup) filtered = filtered.filter(s=>s.group===selectedGroup);

    renderDailySchedule(filtered);
});

// Show all
showAllBtn.addEventListener('click', ()=>renderDailySchedule(allSchedules));

function renderDailySchedule(list){
    if(list.length===0){
        dailySchedule.innerHTML='<p class="text-center text-muted">Kh√¥ng c√≥ l·ªãch n√†o üíñ</p>';
        dailySchedule.style.display='block';
        return;
    }
    let html='';
    list.forEach(item=>{
        html+=`<div class="accordion-item">
        <h2 class="accordion-header" id="heading${item.id}">
            <button class="accordion-button collapsed" type="button" 
                data-bs-toggle="collapse" 
                data-bs-target="#collapse${item.id}" 
                aria-expanded="false" 
                aria-controls="collapse${item.id}">
            ${item.subject} (${item.time}) - ${item.day || 'N/A'} - 
            ${item.status==='ch∆∞a'
                ?'üü¢ Ch∆∞a'
                :(item.status==='ho√†n th√†nh'
                    ?'üíñ Ho√†n th√†nh'
                    :'‚ö†Ô∏è Tr·ªÖ')}
        </button>
        </h2>
        <div id="collapse${item.id}" class="accordion-collapse collapse" aria-labelledby="heading${item.id}" data-bs-parent="#daily-schedule">
            <div class="accordion-body">
                <p><strong>Ng√†y:</strong> ${item.date}</p>
                <p><strong>Ph√≤ng:</strong> ${item.room}</p>
                <p><strong>Nh√≥m:</strong> ${item.group}</p>
                <p><strong>Ti·∫øt:</strong> ${item.sessions}</p>
                <div class="d-flex gap-2">
                    <button class="btn btn-success btn-sm" onclick="markComplete(${item.id})">Ho√†n th√†nh üíñ</button>
                    <button class="btn btn-danger btn-sm" onclick="deleteSchedule(${item.id})">X√≥a üóëÔ∏è</button>
                </div>
            </div>
        </div>
        </div>`;
    });
    dailySchedule.innerHTML=html;
    dailySchedule.style.display='block';
}

function markComplete(id){
    const s=allSchedules.find(x=>x.id===id);
    if(s){ 
        s.status='ho√†n th√†nh'; 
        alert(`üíñ ƒê√£ ƒë√°nh d·∫•u "${s.subject}" l√† ho√†n th√†nh`);
        renderDailySchedule(allSchedules.filter(x=>(!filterDate.value||x.date===filterDate.value) && (!filterSubject.value||x.subject===filterSubject.value) && (!filterGroup.value||x.group===filterGroup.value)));
        fetch(`/mark_complete/${id}`, {method:'POST'});
    }
}

function deleteSchedule(id){
    if(confirm('B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a l·ªãch n√†y kh√¥ng?')){
        allSchedules=allSchedules.filter(x=>x.id!==id);
        renderDailySchedule(allSchedules.filter(x=>(!filterDate.value||x.date===filterDate.value) && (!filterSubject.value||x.subject===filterSubject.value) && (!filterGroup.value||x.group===filterGroup.value)));
        fetch(`/delete_schedule/${id}`, {method:'POST'});
    }
}

// --- S·∫Øp x·∫øp l·ªãch h·ªçc ---
document.getElementById("sort-btn-hoc").addEventListener("click", function() {
    fetch("/get_sorted_schedules", { method: "GET" })
        .then(res => res.json())
        .then(data => {
            if (data && data.length > 0) {
                allSchedules = data;
                renderDailySchedule(allSchedules);

                // üåà Hi·ªáu ·ª©ng rung nh·∫π khi s·∫Øp x·∫øp xong
                const list = document.getElementById("schedule-list");
                if (list) {
                    list.classList.add("shake");
                    setTimeout(() => list.classList.remove("shake"), 400);
                }
            } else {
                alert("Kh√¥ng c√≥ d·ªØ li·ªáu ƒë·ªÉ s·∫Øp x·∫øp.");
            }
        })
        .catch(err => {
            console.error(err);
            alert("L·ªói khi s·∫Øp x·∫øp d·ªØ li·ªáu!");
        });
});




// --- L·ªãch Thi ---
const examFilterDate = document.getElementById('exam-filter-date');
const examFilterSubject = document.getElementById('exam-filter-subject');
const examFilterRoom = document.getElementById('exam-filter-room');
const examFilterBtn = document.getElementById('exam-filter-btn');
const examShowAllBtn = document.getElementById('exam-show-all-btn');
const examSchedule = document.getElementById('exam-schedule');
const uploadAreaThi = document.getElementById("upload-area-thi");
const fileUploadThi = document.getElementById("file-upload-thi");

let allExams = [];

// Cho click v√†o khung upload -> m·ªü ch·ªçn file
uploadAreaThi.addEventListener("click", () => fileUploadThi.click());

// Populate filter
function populateExamFilters() {
    const subjectSet = new Set();
    const roomSet = new Set();

    allExams.forEach(e => {
        if (e.subject) subjectSet.add(e.subject);
        if (e.room) roomSet.add(e.room);
    });

    examFilterSubject.innerHTML = `<option value="">-- Ch·ªçn m√¥n thi --</option>`;
    examFilterRoom.innerHTML = `<option value="">-- Ch·ªçn ph√≤ng --</option>`;

    subjectSet.forEach(sub => {
        examFilterSubject.innerHTML += `<option value="${sub}">${sub}</option>`;
    });

    roomSet.forEach(r => {
        examFilterRoom.innerHTML += `<option value="${r}">${r}</option>`;
    });
}

// Render exam schedule
function renderExamSchedule(list) {
    examSchedule.innerHTML = "";
    if (list.length === 0) {
        examSchedule.innerHTML = `<p class="text-center text-muted">Kh√¥ng c√≥ l·ªãch thi n√†o.</p>`;
        return;
    }

    list.forEach((item, idx) => {
        examSchedule.innerHTML += `
        <div class="accordion-item">
            <h2 class="accordion-header" id="heading-exam-${idx}">
                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" 
                    data-bs-target="#collapse-exam-${idx}" aria-expanded="false" aria-controls="collapse-exam-${idx}">
                    ${item.subject} ‚Äì ${item.date} ‚Äì ${item.time} ‚Äì Ph√≤ng ${item.room}
                </button>
            </h2>
            <div id="collapse-exam-${idx}" class="accordion-collapse collapse" 
                 aria-labelledby="heading-exam-${idx}" data-bs-parent="#exam-schedule">
                <div class="accordion-body">
                    <p><b>M√¥n thi:</b> ${item.subject}</p>
                    <p><b>T√≠n ch·ªâ:</b> ${item.credits || "N/A"}</p>
                    <p><b>Ng√†y thi:</b> ${item.date}</p>
                    <p><b>Gi·ªù thi:</b> ${item.time}</p>
                    <p><b>Ph√≤ng thi:</b> ${item.room}</p>
                </div>
            </div>
        </div>`;
    });
}

// Fetch all exams
function fetchAllExams() {
    fetch('/get_all_exams')
        .then(res => res.json())
        .then(data => {
            allExams = data;
            populateExamFilters();
            renderExamSchedule(allExams);
        })
        .catch(err => console.error(err));
}
fetchAllExams();

// Filter click
examFilterBtn.addEventListener('click', () => {
    const selectedDate = examFilterDate.value;
    const selectedSubject = examFilterSubject.value;
    const selectedRoom = examFilterRoom.value;

    let filtered = allExams;
    if (selectedDate) filtered = filtered.filter(e => e.date === selectedDate);
    if (selectedSubject) filtered = filtered.filter(e => e.subject === selectedSubject);
    if (selectedRoom) filtered = filtered.filter(e => e.room === selectedRoom);

    renderExamSchedule(filtered);
});

// Show all
examShowAllBtn.addEventListener('click', () => {
    renderExamSchedule(allExams);
});

// Upload & x·ª≠ l√Ω ·∫£nh l·ªãch thi
fileUploadThi.addEventListener("change", function (event) {
    const file = event.target.files[0];
    if (!file) return;

    // Preview ·∫£nh
    const reader = new FileReader();
    reader.onload = (e) => {
        document.getElementById("preview-image-thi").style.display = "block";
        document.getElementById("image-preview-thi").src = e.target.result;
    };
    reader.readAsDataURL(file);

    // Hi·ªán spinner
    document.getElementById("loading-spinner-thi").style.display = "block";
    document.getElementById("result-area-thi").style.display = "none";

    // G·ª≠i ·∫£nh ƒë·∫øn backend
    const formData = new FormData();
    formData.append("file", file);
    formData.append("username", "demo_user"); // ho·∫∑c l·∫•y t·ª´ session

    fetch("/process_exam_image", {
        method: "POST",
        body: formData
    })
    .then(response => response.json())
    .then(data => {
        document.getElementById("loading-spinner-thi").style.display = "none";

        if (data.error) {
            alert(data.error);
            return;
        }

        // Hi·ªÉn th·ªã k·∫øt qu·∫£ l·ªãch thi
        const detailsDiv = document.getElementById("schedule-details-thi");
        detailsDiv.innerHTML = "";

        if (data.exam_info) {
            detailsDiv.innerHTML += `<p><b>Th√¥ng tin k·ª≥ thi:</b> ${data.exam_info}</p>`;
        }

        if (data.exams && data.exams.length > 0) {
            let table = `
                <table class="table table-bordered table-striped">
                    <thead class="table-primary">
                        <tr>
                            <th>M√¥n h·ªçc</th>
                            <th>Ng√†y thi</th>
                            <th>Gi·ªù thi</th>
                            <th>Ph√≤ng</th>
                            <th>T√≠n ch·ªâ</th>
                        </tr>
                    </thead>
                    <tbody>
            `;

            data.exams.forEach(exam => {
                table += `
                    <tr>
                        <td>${exam.subject}</td>
                        <td>${exam.date}</td>
                        <td>${exam.time}</td>
                        <td>${exam.room}</td>                         
                        <td>${exam.credits}</td>
                    </tr>
                `;
            });

            table += `</tbody></table>`;
            detailsDiv.innerHTML += table;
        }

        document.getElementById("result-area-thi").style.display = "block";

        // C·∫≠p nh·∫≠t lu√¥n danh s√°ch exam local ƒë·ªÉ filter
        allExams = [...allExams, ...(data.exams || [])];
        populateExamFilters();
        renderExamSchedule(allExams);
    })
    .catch(error => {
        console.error("L·ªói khi x·ª≠ l√Ω:", error);
        document.getElementById("loading-spinner-thi").style.display = "none";
        alert("C√≥ l·ªói x·∫£y ra khi g·ª≠i ·∫£nh!");
    });
});

</script>
</body>
</html>
